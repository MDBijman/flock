# Flock Language Specification

This language contains a compiler and runtime for incremental FlowSpec.

## Structure

### Runtime (`src/main/strategies/flock/`)

- `ast`: language parametric strategies that expose the runtime to Stratego
- `common`: language parametric implementation of the runtime
- `impl`: language-specific CFG builder (contains a stub)
- `strategies`: default Stratego project files, with InteropRegister 

### Language Definition

Syntax definition of FlowSpec is in `syntax/`.

### Compiler

The implementation of the compiler can be found in `trans/`.

The compiler has three types of output: CFG generator, analysis implementation, and analysis properties. The CFG generator is (usually) generated once per subject language. The analysis and analysis properties are generated for each analysis.

The entry points in the compiler for these three outputs can be found in `codegen/files`.

When the `flock` project is built and recognized by Spoofax, files with the `.flock` can be compiled into either of the three. The CFG generator requires that the Flock file contains a CFG definition. The others require property rules.

## Using Flock

To use Flock for a subject language, you need to do the following:
- Write `.flock` files with the CFG definition and analyses
- Compile the files and add the Java files to the project
- Copy the runtime into your project
- Use the analyses from your Stratego code

## Issues

- The getTermDependencies method is not yet implemented in the compiler. A handwritten version is currently used in project using Flock, e.g. in `flock.subject`. The method stub is in `Analysis.java:121`.
- The interop classes are not yet autogenerated. Examples can again be found in `flock.subject` in `src/main/strategies/flock.subject.{live, value, alias}`, in files with names following the `<analysis>_0_1.java` format.
